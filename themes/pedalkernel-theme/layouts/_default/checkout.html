{{ define "main" }}
<section class="checkout-page">
  <div class="container">
    <div class="checkout-grid">
      <div class="checkout-form-section">
        <a href="/" class="back-link">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 10H5M5 10L10 5M5 10L10 15" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back to PedalKernel Pro
        </a>
        
        <h1>Complete Your Purchase</h1>
        <p class="checkout-subtitle">Secure checkout via GSG Ecommerce</p>
        
        <div id="gsg-checkout" data-checkout-mount>
          <noscript>
            <p>JavaScript is required to complete your purchase. Please enable JavaScript and try again.</p>
          </noscript>
        </div>
        
        <p class="checkout-terms">
          By completing this purchase, you agree to our <a href="/terms">Terms of Service</a> and <a href="/privacy">Privacy Policy</a>.
        </p>
      </div>
      
      <div class="checkout-summary">
        <div class="summary-card">
          <h3>Order Summary</h3>
          <div id="cart-summary" data-cart-summary>
            <div class="summary-item">
              <div class="item-info">
                <span class="item-name">PedalKernel Pro</span>
                <span class="item-desc">VST3 Plugin License</span>
              </div>
              <span class="item-price">$49.00</span>
            </div>
          </div>
          
          <div class="summary-features">
            <div class="summary-feature">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/><path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>Lifetime license</span>
            </div>
            <div class="summary-feature">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/><path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>3 activations included</span>
            </div>
            <div class="summary-feature">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/><path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>All future updates free</span>
            </div>
          </div>
          
          <div class="summary-divider"></div>
          
          <div class="summary-total">
            <span>Total</span>
            <span class="total-price" data-cart-total>$49.00 USD</span>
          </div>
          
          <div class="summary-guarantee">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M10 2L3 6V11C3 15.5 6 19.26 10 20C14 19.26 17 15.5 17 11V6L10 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M6 10L9 13L14 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span>30-day money-back guarantee</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
(function(){
  // GSG Ecommerce checkout integration
  const API_BASE = "https://api.gsgmfg.com";
  
  function initCheckout() {
    // Add product to cart on page load
    if (window.GSGCart) {
      window.GSGCart.add('PK-PRO-001', 1);
    }
    
    // Mount checkout component if available
    const mount = document.querySelector('[data-checkout-mount]');
    if (mount && window.GSGCore && window.GSGCore.mountCheckout) {
      window.GSGCore.mountCheckout(mount, {
        onSuccess: function(order) {
          window.location.href = '/success/?order=' + order.id;
        },
        onError: function(err) {
          console.error('Checkout error:', err);
        }
      });
    } else {
      // Fallback: redirect to GSG hosted checkout
      mount.innerHTML = '<p>Loading checkout...</p>';
      if (window.GSGCart) {
        window.GSGCart.checkoutClean();
        setTimeout(function() {
          window.location.href = API_BASE + '/checkout?storefront=pedalkernel';
        }, 1000);
      }
    }
  }
  
  // Update cart summary
  function updateSummary() {
    if (!window.GSGCart) return;
    const cart = window.GSGCart.get();
    const total = document.querySelector('[data-cart-total]');
    if (total && cart) {
      const amount = (cart.total_cents || 4900) / 100;
      total.textContent = '$' + amount.toFixed(2) + ' USD';
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCheckout);
  } else {
    initCheckout();
  }
  
  // Listen for cart updates
  document.addEventListener('cart:updated', updateSummary);
})();
</script>

<style>
.checkout-page {
  padding: 2rem 0;
}

.checkout-grid {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 3rem;
  max-width: 1200px;
  margin: 0 auto;
}

@media (max-width: 900px) {
  .checkout-grid {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
}

.back-link {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--muted);
  text-decoration: none;
  margin-bottom: 1.5rem;
  transition: color 0.2s;
}

.back-link:hover {
  color: var(--text);
}

.checkout-form-section h1 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.checkout-subtitle {
  color: var(--muted);
  margin-bottom: 2rem;
}

#gsg-checkout {
  min-height: 400px;
  background: var(--card-bg);
  border-radius: 8px;
  padding: 1.5rem;
}

.summary-card {
  background: var(--card-bg);
  border-radius: 12px;
  padding: 1.5rem;
  position: sticky;
  top: 2rem;
}

.summary-card h3 {
  margin-bottom: 1.5rem;
  font-size: 1.1rem;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border);
}

.item-info {
  display: flex;
  flex-direction: column;
}

.item-name {
  font-weight: 600;
}

.item-desc {
  font-size: 0.9rem;
  color: var(--muted);
}

.item-price {
  font-weight: 700;
  font-size: 1.1rem;
}

.summary-features {
  margin: 1.5rem 0;
}

.summary-feature {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  font-size: 0.9rem;
}

.summary-feature svg {
  color: var(--accent);
}

.summary-divider {
  height: 1px;
  background: var(--border);
  margin: 1.5rem 0;
}

.summary-total {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 1.1rem;
  margin-bottom: 1rem;
}

.total-price {
  font-weight: 700;
  font-size: 1.3rem;
}

.summary-guarantee {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem;
  background: rgba(0, 188, 212, 0.1);
  border-radius: 8px;
  font-size: 0.9rem;
  color: var(--accent);
}

.checkout-terms {
  margin-top: 2rem;
  font-size: 0.85rem;
  color: var(--muted);
}

.checkout-terms a {
  color: var(--accent);
  text-decoration: underline;
}
</style>
{{ end }}